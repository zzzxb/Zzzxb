---
layout: post
title:  "Java RMI 使用"
date:   2022-08-06 14:11:00 +0800
categories: Java
tag: Java
---

* content
{:toc}

## 简介

RMI (Remote Method Invocation) 模型是一种分布式对象应用，使用 RMI 技术可以使一个 JVM 中的对象，调用另一个 JVM 中的对象方法并获取调用结果。这里的另一个 JVM 可以在同一台计算机也可以是远程计算机。因此，RMI 意味着需要一个 Server 端和一个 Client 端。  
Server 端通常会创建一个对象，并使之可以被远程访问。  
这个对象被称为远程对象。Server 端需要注册这个对象可以被 Client 远程访问。  
Client 端调用可以被远程访问的对象上的方法，Client 端就可以和 Server 端进行通信并相互传递信息。  
说到这里，是不是发现使用 RMI 在构建一个分布式应用时十分方便，它和 RPC(Feign、Dubbo) 一样可以实现分布式应用之间的互相通信，甚至和现在的微服务思想都十分类似。

## 实现

* MyRemote

```java
import java.rmi.Remote;
import java.rmi.RemoteException;

/**
 * 远程接口
 */
public interface MyRemote extends Remote {

    public String sayHello() throws RemoteException;
}
```

### 服务端

* MyRemoteImpl

```java
import java.rmi.Naming;
import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;

/**
 * 远程服务实现
 */
public class MyRemoteImpl extends UnicastRemoteObject implements MyRemote {

    protected MyRemoteImpl() throws RemoteException {
    }

    @Override
    public String sayHello() throws RemoteException {
        return "Server says, Hey";
    }

    public static void main(String[] args) {
        try {
            MyRemote service = new MyRemoteImpl();
            Naming.rebind("RemoteHello", service);
        }catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

1. `javac MyRemoteImpl.java`
2. `rmic MyRemoteImpl` 注意，项目不要有package，不然需要通过自定义参数执行
3. `rmiregistry`
4. `java MyRemoteImpl`

* 需要用到  
> `MyRemote.java`  
> `MyRemoteImpl.java`  
> `MyRemoteImpl_Stub.class`

### 客户端

* MyRemoteClient

```java
import java.rmi.Naming;

/**
 * 客户端
 */
public class MyRemoteClient {
    private final static String PROTOCOL = "rmi://";

    public static void main(String[] args) {
        String address = "127.0.0.1";
        String remoteMethod = "/RemoteHello";
        if (args.length >= 2) {
            address = args[0];
            remoteMethod = args[1];
        }
        new MyRemoteClient().go(address, remoteMethod);
    }

    public void go(String address, String remoteMethod) {
        try {
            MyRemote service = (MyRemote) Naming.lookup( PROTOCOL + address + remoteMethod );
            String s = service.sayHello();
            System.out.println(s);
        }catch (Exception e) {
            e.printStackTrace();
        }
    }
}
```

1. `javac MyRemoteClient.java`
2. `java MyRemoteClient`
3. 执行完后，控制台就会输出: `Server says, Hey`

* 需要用到  
> `MyRemote.java`  
> `MyRemoteClient.java`  
> `MyRemoteImpl_Stub.class`


## 参考

* [Java的RMI介绍及使用方法详解](https://m.w3cschool.cn/article/30445887.html)
* [Head First Java] P445 - 代理模式